<!DOCTYPE html>
<html lang="nl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Spaanse Woordenschat Trainer</title>
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; max-width: 800px; margin: 0 auto; }
        .container { background: white; padding: 20px; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); }
        .input-group { margin-bottom: 15px; }
        input { padding: 8px; margin: 5px; width: 200px; }
        button { background: #0066cc; color: white; border: none; padding: 10px 20px; border-radius: 4px; cursor: pointer; }
        button:disabled { background: #cccccc; }
        .feedback { margin-top: 10px; padding: 10px; border-radius: 4px; }
        .success { background: #d4edda; color: #155724; }
        .error { background: #f8d7da; color: #721c24; }
    </style>
</head>
<body>
    <div class="container">
        <div id="setup">
            <h2>GitHub Instellingen</h2>
            <div class="input-group">
                <input type="text" id="repoOwner" placeholder="GitHub gebruikersnaam"><br>
                <input type="text" id="repoName" placeholder="Repository naam"><br>
                <input type="password" id="githubToken" placeholder="GitHub Personal Access Token"><br>
                <button id="saveSettings">Instellingen opslaan</button>
            </div>
        </div>

        <div id="wordInput" style="display: none;">
            <h2>Nieuwe woorden toevoegen</h2>
            <div class="input-group">
                <input type="text" id="dutchWord" placeholder="Nederlands woord">
                <input type="text" id="spanishWord" placeholder="Spaans woord">
                <button id="addWord">Toevoegen (<span id="wordCount">0</span>/10)</button>
            </div>
            <button id="startPractice" disabled>Start oefening</button>
        </div>

        <div id="practice" style="display: none;">
            <h2>Oefenen</h2>
            <p id="dutchPrompt"></p>
            <div class="input-group">
                <input type="text" id="answer" placeholder="Spaanse vertaling">
                <button id="checkAnswer">Controleer</button>
            </div>
            <div id="feedback"></div>
            <p id="progress"></p>
        </div>
    </div>

    <script>
        let githubConfig = {};
        let todaysWords = [];
        let practiceWords = [];
        let currentWordIndex = 0;

        // Configuratie opslaan
        document.getElementById('saveSettings').addEventListener('click', async () => {
            githubConfig = {
                owner: document.getElementById('repoOwner').value,
                repo: document.getElementById('repoName').value,
                token: document.getElementById('githubToken').value
            };

            // Configuratie opslaan
            localStorage.setItem('githubConfig', JSON.stringify(githubConfig));

            // Test de verbinding
            try {
                await initializeRepository();
                document.getElementById('setup').style.display = 'none';
                document.getElementById('wordInput').style.display = 'block';
                await loadWords();
            } catch (error) {
                alert('Er ging iets mis met de verbinding. Controleer uw instellingen.');
                console.error(error);
            }
        });

        // GitHub repository initialiseren
        async function initializeRepository() {
            try {
                const response = await fetch(`https://api.github.com/repos/${githubConfig.owner}/${githubConfig.repo}/contents/words.json`, {
                    headers: {
                        'Authorization': `token ${githubConfig.token}`
                    }
                });

                if (response.status === 404) {
                    // Maak words.json aan als het nog niet bestaat
                    await saveWords([]);
                }
            } catch (error) {
                console.error('Fout bij initialiseren:', error);
                throw error;
            }
        }

        // Woorden ophalen
        async function loadWords() {
            try {
                const response = await fetch(`https://api.github.com/repos/${githubConfig.owner}/${githubConfig.repo}/contents/words.json`, {
                    headers: {
                        'Authorization': `token ${githubConfig.token}`
                    }
                });
                
                if (response.ok) {
                    const data = await response.json();
                    const content = atob(data.content);
                    const words = JSON.parse(content);
                    updateWordCount(words);
                    return words;
                }
                return [];
            } catch (error) {
                console.error('Fout bij laden:', error);
                return [];
            }
        }

        // Woorden opslaan
        async function saveWords(words) {
            try {
                // Eerst huidige file info ophalen voor de SHA
                let sha = '';
                try {
                    const fileInfo = await fetch(`https://api.github.com/repos/${githubConfig.owner}/${githubConfig.repo}/contents/words.json`, {
                        headers: {
                            'Authorization': `token ${githubConfig.token}`
                        }
                    });
                    if (fileInfo.ok) {
                        const data = await fileInfo.json();
                        sha = data.sha;
                    }
                } catch (e) {
                    // File bestaat nog niet
                }

                // Update of maak het bestand
                const response = await fetch(`https://api.github.com/repos/${githubConfig.owner}/${githubConfig.repo}/contents/words.json`, {
                    method: 'PUT',
                    headers: {
                        'Authorization': `token ${githubConfig.token}`,
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        message: 'Update woorden',
                        content: btoa(JSON.stringify(words, null, 2)),
                        sha: sha || undefined
                    })
                });

                if (!response.ok) {
                    throw new Error('Fout bij opslaan');
                }
            } catch (error) {
                console.error('Fout bij opslaan:', error);
                alert('Er ging iets mis bij het opslaan.');
            }
        }

        // Word counter bijwerken
        function updateWordCount(words) {
            const today = new Date().toISOString().split('T')[0];
            const todayCount = words.filter(w => w.date === today).length;
            document.getElementById('wordCount').textContent = todayCount;
            document.getElementById('startPractice').disabled = todayCount < 10;
        }

        // Woord toevoegen
        document.getElementById('addWord').addEventListener('click', async () => {
            const dutch = document.getElementById('dutchWord').value.trim();
            const spanish = document.getElementById('spanishWord').value.trim();
            
            if (dutch && spanish) {
                const words = await loadWords();
                const today = new Date().toISOString().split('T')[0];
                const todayCount = words.filter(w => w.date === today).length;
                
                if (todayCount < 10) {
                    words.push({
                        dutch,
                        spanish,
                        date: today
                    });
                    await saveWords(words);
                    document.getElementById('dutchWord').value = '';
                    document.getElementById('spanishWord').value = '';
                    updateWordCount(words);
                } else {
                    alert('Je hebt al 10 woorden toegevoegd voor vandaag!');
                }
            }
        });

        // Start oefening
        document.getElementById('startPractice').addEventListener('click', async () => {
            const words = await loadWords();
            const today = new Date().toISOString().split('T')[0];
            const todayWords = words.filter(w => w.date === today);
            const oldWords = words.filter(w => w.date !== today);
            
            practiceWords = [
                ...todayWords,
                ...oldWords.sort(() => 0.5 - Math.random()).slice(0, 5)
            ].sort(() => 0.5 - Math.random());
            
            currentWordIndex = 0;
            showPracticeWord();
            
            document.getElementById('wordInput').style.display = 'none';
            document.getElementById('practice').style.display = 'block';
        });

        // Toon oefenwoord
        function showPracticeWord() {
            const word = practiceWords[currentWordIndex];
            document.getElementById('dutchPrompt').textContent = word.dutch;
            document.getElementById('answer').value = '';
            document.getElementById('feedback').innerHTML = '';
            document.getElementById('progress').textContent = 
                `Woord ${currentWordIndex + 1} van ${practiceWords.length}`;
        }

        // Controleer antwoord
        document.getElementById('checkAnswer').addEventListener('click', () => {
            const answer = document.getElementById('answer').value.trim().toLowerCase();
            const correctAnswer = practiceWords[currentWordIndex].spanish.toLowerCase();
            const feedback = document.getElementById('feedback');
            
            if (answer === correctAnswer) {
                feedback.innerHTML = '<div class="success">Correct!</div>';
            } else {
                feedback.innerHTML = 
                    `<div class="error">Niet correct. Het juiste antwoord is: ${practiceWords[currentWordIndex].spanish}</div>`;
            }
            
            setTimeout(() => {
                currentWordIndex++;
                if (currentWordIndex < practiceWords.length) {
                    showPracticeWord();
                } else {
                    document.getElementById('wordInput').style.display = 'block';
                    document.getElementById('practice').style.display = 'none';
                }
            }, 2000);
        });

        // Enter toets ondersteuning
        document.getElementById('answer').addEventListener('keypress', (e) => {
            if (e.key === 'Enter') {
                document.getElementById('checkAnswer').click();
            }
        });

        // Laad bestaande configuratie
        const savedConfig = localStorage.getItem('githubConfig');
        if (savedConfig) {
            githubConfig = JSON.parse(savedConfig);
            document.getElementById('repoOwner').value = githubConfig.owner;
            document.getElementById('repoName').value = githubConfig.repo;
            document.getElementById('githubToken').value = githubConfig.token;
        }
    </script>
</body>
</html>
